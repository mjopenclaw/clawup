## 📋 워커(Cron) 현황

### 아키텍처: Goal-Driven Autonomous Workers

```
┌─────────────────────────────────────────────────────────────┐
│                    GOAL-DRIVEN CRON                          │
├─────────────────────────────────────────────────────────────┤
│  1. PLAN      → 목표 상태 확인, 진행 여부 결정               │
│  2. RESEARCH  → 최적 전략 탐색 (DB + 웹)                     │
│  3. EXECUTE   → 작업 수행                                    │
│  4. FEEDBACK  → 결과 측정, DB 기록                           │
│  5. RETRY     → 실패 시 다른 방법으로 재시도                 │
└─────────────────────────────────────────────────────────────┘
```

### 🎯 Goal-Driven 원칙

**모든 Cron은 목표(Goal)를 달성하기 위해 존재한다.**

```yaml
# 예시: posting-executor
goal:
  id: "daily_posts"
  target: 3
  metric: "SELECT COUNT(*) FROM posts WHERE date(created_at) = date('now')"
```

- 목표 달성 시 → 자동 스킵
- 실패 시 → 다른 전략으로 재시도
- 데이터 기반 → 모든 결정은 DB 쿼리로

---

### 🔄 Core Loops (10분 간격)

| 워커 | Goal | 역할 |
|------|------|------|
| **posting-executor** | 일일 3개 포스팅 | Queue에서 꺼내 X+Threads 포스팅 |
| **metrics-collector** | 데이터 최신화 | 팔로워/engagement 수집 |
| **engagement-watcher** | 상호작용 응답 | 멘션/답글 감지 → 응답 |

### 📅 Daily

| 워커 | Goal | 시간 |
|------|------|------|
| **morning-planner** | 일일 계획 수립 | 09:00 |
| **evening-analyzer** | 인사이트 추출 | 22:00 |
| **content-generator** | 콘텐츠 파이프라인 | 14:00 |

### 📆 Weekly

| 워커 | Goal | 시간 |
|------|------|------|
| **strategy-reviewer** | 전략 최적화 | 일 20:00 |
| **framework-improver** | 프레임워크 발전 | 월 04:00 |

---

### 실행 흐름 예시

```
[posting-executor 실행]

1. PLAN
   ├─ Queue 확인: 11개 pending ✅
   ├─ 일일 한도: 2/6 ✅
   └─ Rate limit: 0/2 ✅
   → 진행

2. RESEARCH
   ├─ 최적 주제: "OpenClaw 팁" (avg_engagement 4.2%)
   └─ 최적 시간: 현재 OK (22:00-02:00 고engagement)
   → 관련 콘텐츠 우선 선택

3. EXECUTE
   ├─ Queue에서 콘텐츠 선택
   ├─ X 포스팅 완료
   └─ Threads 포스팅 완료
   → 성공

4. FEEDBACK
   ├─ post_id 기록
   ├─ 5분 후 engagement 체크 예약
   └─ 텔레그램 알림 전송
   → 완료

5. RETRY (필요시)
   └─ 실패 시 다른 콘텐츠로 재시도
```

---

### 데이터 기반 의사결정

```sql
-- 최적 포스팅 시간 (실제 데이터 기반)
SELECT strftime('%H', posted_at) as hour, 
       AVG(likes + replies + retweets) as avg_eng
FROM post_analytics
WHERE posted_at > date('now', '-30 days')
GROUP BY hour
ORDER BY avg_eng DESC
LIMIT 3;

-- 최적 주제
SELECT topic, AVG(engagement_rate) as rate
FROM post_analytics
WHERE posted_at > date('now', '-7 days')
GROUP BY topic
ORDER BY rate DESC;
```

---

### 워커 관리 규칙

**최대 실행 시간**: 55분 (1시간 미만 강제)

**리소스 체크**:
- CPU > 80% → 워커 일시 중지
- Memory > 90% → 비필수 워커 정리
- 정상 → 필요한 만큼 운영

**Retry 규칙**:
- 최대 3회 재시도
- 각 시도마다 다른 전략
- 3회 실패 → 로그 기록 후 스킵

**Goal Progress 기록**:
```sql
INSERT INTO goal_progress (goal_id, current_value, target_value, progress_pct)
VALUES ('x_followers', 62, 1000, 6.2);
```

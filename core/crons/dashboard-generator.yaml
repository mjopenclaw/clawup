# dashboard-generator.yaml - ëŒ€ì‹œë³´ë“œ ìƒì„± Cron
# ì •ê¸°ì ìœ¼ë¡œ ëŒ€ì‹œë³´ë“œë¥¼ ìƒì„±í•˜ê³  ì•Œë¦¼ ë°œì†¡

cron:
  id: dashboard-generator
  name: "ëŒ€ì‹œë³´ë“œ ìƒì„±ê¸°"
  description: "í™œë™ í˜„í™© ëŒ€ì‹œë³´ë“œ ìƒì„± ë° í…”ë ˆê·¸ë¨ ë°œì†¡"

  # === ìŠ¤ì¼€ì¤„ ===
  schedule:
    cron: "0 9,21 * * *"               # ì•„ì¹¨ 9ì‹œ, ì €ë… 9ì‹œ
    timezone: "Asia/Seoul"
    enabled: true

  # === ì‹¤í–‰ ë‹¨ê³„ ===
  steps:
    # 1. ëŒ€ì‹œë³´ë“œ ì„œë¹„ìŠ¤ í˜¸ì¶œ
    - name: "generate_dashboard"
      service: "shared/dashboard/activity"
      output: "dashboard_content"

    # 2. ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ì €ì¥
    - name: "save_markdown"
      action: "write_file"
      path: "memory/dashboard.md"
      content: "${dashboard_content.markdown}"

    # 3. í…”ë ˆê·¸ë¨ ë°œì†¡ (ì•„ì¹¨ë§Œ)
    - name: "send_telegram_morning"
      condition: "current_hour == 9"
      action: "telegram_send"
      target: "${config.telegram.monitor.chat_id}"
      message: |
        â˜€ï¸ **ì•„ì¹¨ ëŒ€ì‹œë³´ë“œ**

        ${dashboard_content.summary}

        ğŸ“Š ìì„¸í•œ ë‚´ìš©: memory/dashboard.md

    # 4. í…”ë ˆê·¸ë¨ ë°œì†¡ (ì €ë…)
    - name: "send_telegram_evening"
      condition: "current_hour == 21"
      action: "telegram_send"
      target: "${config.telegram.monitor.chat_id}"
      message: |
        ğŸŒ™ **ì €ë… ëŒ€ì‹œë³´ë“œ**

        ${dashboard_content.summary}

        **ì˜¤ëŠ˜ì˜ ì„±ê³¼:**
        ${dashboard_content.today_highlights}

        ğŸ“Š ìì„¸í•œ ë‚´ìš©: memory/dashboard.md

  # === ì¶”ê°€ íŠ¸ë¦¬ê±° ===
  additional_triggers:
    # ëª©í‘œ ë‹¬ì„± ì‹œ
    - event: "goal_achieved"
      action: "generate_and_notify"
      message_prefix: "ğŸ‰ **ëª©í‘œ ë‹¬ì„±!**"

    # íŠ¹ë³„ ì´ë²¤íŠ¸ ì‹œ
    - event: "milestone_reached"
      action: "generate_and_notify"
      message_prefix: "ğŸ† **ë§ˆì¼ìŠ¤í†¤ ë‹¬ì„±!**"

  # === ë¡œê¹… ===
  logging:
    log_runs: true
    log_path: "data/cron_dashboard.json"
